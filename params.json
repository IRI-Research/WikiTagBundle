{"name":"Wikitagbundle","body":"# WikiTagBundle\r\n\r\nWikiTagBundle is a php bundle for [Symfony 2](http://symfony.com/) released by the [Institute for research and innovation](http://www.iri.centrepompidou.fr/) (IRI).\r\nIt enables to add semantised tags to any kind of document. \r\nBy semantised, we mean that a tag has its label, but also a wikipedia link related to this label. Right now, for v1.0, it works with the french wikipedia.\r\nFor a simple example, the tag \"Asie\" is related to the link [http://fr.wikipedia.org/wiki/Asie](http://fr.wikipedia.org/wiki/Asie).\r\nThe tag can also be categorised, by any value in a list.\r\nThe tag can also have an alias, which is any string value.\r\nWhen a wikipedia entry is found, the bundle also searches a [dbPedia](http://dbpedia.org/) entry for the english equivalent, for example [http://dbpedia.org/page/Asia](http://dbpedia.org/page/Asia).\r\n\r\nA tag can have 4 kinds of wikipedia links :\r\n\r\n* **match** - Perfect match between the label and the wikipedia entry (i.e. [Asie](http://fr.wikipedia.org/wiki/Asie)).\r\n* **redirection** - The label exists in wikipedia but redirects to an other entry (i.e. Louis XIV to [Louis XIV de France](http://fr.wikipedia.org/wiki/Louis_XIV_de_France)).\r\n* **homonymy** - The label leads to wikipedia homonymy page (i.e. [Abstraction](http://fr.wikipedia.org/wiki/Abstraction)).\r\n* **null result** - The label is not related to any wikipedia entry. So we build a link leading to the search page (i.e. [art multimédia](http://fr.wikipedia.org/w/index.php?search=art+multim%C3%A9dia)).\r\n\r\n\r\n\r\n## Install\r\nWikiTagBundle is a php bundle for [Symfony 2](http://symfony.com/).\r\n\r\n* Install the dependencies : [PagerFanta](https://github.com/whiteoctober/Pagerfanta) and [Mondator](https://github.com/mandango/mondator).\r\n* Download the zipfile from the [downloads](https://github.com/) page and install it.\r\n* Once unzipped, just copy the IRI folder in your vendor/bundles folder. The folder hierarchy will be vendor/bundles/IRI/Bundle/WikiTagBundle.\r\n\r\n## License\r\n\r\nThis bundle is under the CeCILL-C license. See the complete license in the bundle:\r\n\r\n    Resources/meta/LICENSE\r\n\r\n   \r\n## Getting Started\r\n* Install WikiTagBundle\r\n* Register the bundle in AppKernel.php :\r\n\r\n         ... new IRI\\Bundle\\WikiTagBundle\\WikiTagBundle(), ...\r\n\r\n* Register the namespace in the autoload.php :\r\n\r\n         ... 'IRI\\Bundle\\WikiTagBundle'   => \\_\\_DIR\\_\\_.'/../vendor/bundles', ...\r\n    \r\n* Register the namespace fallbacks in the autoload.php :\r\n\r\n        $loader->registerNamespaceFallbacks(array(\r\n            \\_\\_DIR\\_\\_.'/../src',\r\n            \\_\\_DIR\\_\\_.'/cache/dev/wikitag',\r\n            \\_\\_DIR\\_\\_.'/cache/prod/wikitag',\r\n            \\_\\_DIR\\_\\_.'/cache/test/wikitag',\r\n            \\_\\_DIR\\_\\_.'/cache/task/wikitag',\r\n        ));\r\n\r\n* Since WikiTagBundle builds its own document class from the host app's document class, you need to tell in config.yml what is the host app's document class and what _text_ fields will be used in this class. \r\nThese fields are used for searching and to calculate the tag's weight. Example :\r\n\r\n        wiki_tag:\r\n            document_class: Company\\BaseBundle\\Entity\\Document\r\n            document_id_column: id\r\n            fields:\r\n                title:\r\n                    type: string\r\n                    length: 1024\r\n                    accessor: getTitre\r\n                    weight: 1.0\r\n                description:\r\n                    type: text\r\n                    weight: 0.5\r\nThe 'document_id_column' option is used to indicate the primary key column used by the host app's document class. We are currently limited to non composite primary keys.\r\nA field definition has the following format:\r\n<field name>:\r\n    type: <string or text> : field type. default : text \r\n    length: <int> : the length of the field. ignored if field type is text\r\n    accessor: <field name or method name> : the field name in the host app's document class, or the name of the method used to access the field value. If not found it will try ta add 'get' in frint of the name. Default : the field name\r\n    weight: <float> : the weight used for this field to calculate the score of each tag. default : 1.0 \r\n\r\n* Add the WikiTag routes to your routing.yml :\r\n\r\n        WikiTagBundle:\r\n            resource: \"@WikiTagBundle/Resources/config/routing.yml\"\r\n            prefix:   /tag\r\n\r\n* Run the commands :\r\n\r\n        php app/console wikitag:generate-document-class (no need to explain)\r\n        php app/console wikitag:schema:update (also replace and runs php app/console doctrine:schema:update)\r\n        php app/console wikitag:sync-doc (fills the database with the datas from the host document class to the wikitag document class. this command is needed only if the database was not empty)\r\n    \r\n* Your database is ready. You can now include the table of tags in a template. Do not forget css and javascript (and php app/console assets:install). Example :\r\n\r\n        {# example of page extending the base template #}\r\n        {% extends 'CompanyBaseBundle:Default:index.html.twig' %}\r\n        \r\n        {% block css_import %}\r\n        {{ parent() }}\r\n        {% render \"WikiTagBundle:WikiTag:addCss\" %}\r\n        {% endblock %}\r\n        \r\n        {% block js_declaration %}\r\n        {{ parent() }}\r\n        {% render \"WikiTagBundle:WikiTag:addJavascript\" %}\r\n        {% endblock %}\r\n        \r\n        {% block content %}\r\n        <!-- The beginning of your template -->\r\n                {% render \"WikiTagBundle:WikiTag:documentTags\" with {'id_doc': doc.id} %}\r\n        <!-- The end of your template -->\r\n        {% endblock %}\r\n  \r\n* Great ! You can now add/remove/change semantised tags to your document ! The WikiTag template includes an autocomplete search field to add simply and fastly any wikipedia semantised tag.\r\n\r\n\r\n## The list of all tags \r\nIf you want to, you can add into a page the list of all tags. WikiTagBundle manages a list of all tags with the paginator PagerFanta. By default, it displays 50 tags per page.\r\nThe template includes links to quick search via a list of tags's first letter. A search field is also included. It works with the star character (\\*) as a delimiter for searching.\r\nFor example \"\\*Peter\" will return tags ending by Peter, \"Peter\\*\" tags beginning by Peter, and \"\\*Peter\\*\" all tags including Peter. \r\nThe list can be sorted in ascending or descending label, number of documents or popularity (integer value).\r\nWikiTagBundle manages pagination, search, and sort with url parameters. \r\n\r\nExample : http://mysite.com/route\\_to\\_list?searched=Peter\\*&num\\_page=1&nb\\_by\\_page=50&sort=popd\r\n\r\nIncluding the tag list template looks like :\r\n\r\n        {# example of template including the all tags list #}\r\n        {% extends 'CompanyBaseBundle:Default:index.html.twig' %}\r\n        \r\n        {% block css_import %}\r\n        {{ parent() }}\r\n        {% render \"WikiTagBundle:WikiTag:addCss\" %}\r\n        {% endblock %}\r\n        \r\n        {% block js_declaration %}\r\n        {{ parent() }}\r\n        {% render \"WikiTagBundle:WikiTag:addJavascript\" with {'tags_list': true} %}\r\n        {% endblock %}\r\n        \r\n        {% block content %}\r\n        <!-- The beginning of your template -->\r\n            {% render \"WikiTagBundle:WikiTag:allTags\" %}\r\n        <!-- The end of your template -->\r\n        {% endblock %}\r\n\r\n*IMPORTANT* : This template needs a route to be defined in configuration file. Usually, this host site's route leads the a page/document concerned by the clicked tag. \r\nThis route is used by the list to create a link on the \"nb of documents\" column. config.yml looks like :\r\n\r\n        wiki_tag:\r\n            route_for_documents_by_tag: a_route_from_host_site\r\n            document_class: Company\\BaseBundle\\Entity\\Document\r\n            ...\r\n\r\n\r\n## More configuration 1 : tag list profile for a document\r\nVia config.yml, you can configure how columns are displayed for a given user. It also concerns the button \"sort tags\" \r\n(this function orders tags depending of their presence in the text fields set in config.yml). \r\nIs it is very simple. For each profile, you define the display property and the column name. \r\nThe 3 properties available are : 0 : never displayed and not available in the list, 1 : displayed by default and available in the list, 2 : hidden by default but available in the list \r\n(the user can display the column if he wants, by clicking in the list). If the column is not in the profile or if the visibility parameter is undefined, it is considered as 0.\r\nThe column ids are : sort\\_tag, order, move\\_up\\_down, id, label, wikipedia\\_link, wikipedia\\_permalink, dbpedia\\_link, category, remove\\_wikipedia\\_link, alias, remove\\_tag\\_from\\_list, alternative\\_label, alternative\\_wikipedia\\_url.\r\nThe following example make it understable :\r\n\r\n        wiki_tag:\r\n            ...\r\n            document_list_profile:\r\n                all:\r\n                    sort_tag:\r\n                        visibility: 0\r\n                    order:\r\n                        label:      'Pertinence'\r\n                        visibility: 1\r\n                    move_up_down:\r\n                        visibility: 1\r\n                    ...\r\n                    alternative_label:\r\n                        label:      'Label redirigé'\r\n                        visibility: 2\r\n                    alternative_wikipedia_url:\r\n                        label:      'Lien redirigé'\r\n                        visibility: 1\r\n                editor:\r\n                    order:\r\n                        label:      '#'\r\n                        visibility: 1\r\n                    move_up_down:\r\n                        visibility: 0\r\n                    ...\r\n                    alias:\r\n                        label:      'Alias'\r\n                        visibility: 1\r\n                    remove_tag_from_list:\r\n                        label:      'Retirer le tag'\r\n                        visibility: 2\r\n\r\nIn these values, \"sort_tag\" means the sort tag button. All the other values are the available columns in the tag table.\r\nOnce this configuration set, call the profile in your template. The profile has to be called in the javascript call AND in the html call. So your template will look like this :\r\n\r\n        ...\r\n        {% render \"WikiTagBundle:WikiTag:addJavascript\" with {'profile_name': 'editor'} %}\r\n        ...\r\n        {% render \"WikiTagBundle:WikiTag:documentTags\" with {'id_doc': doc.id, 'profile_name': 'editor'} %}\r\n        ...\r\n\r\n\r\n## More configuration 2 : add context seach to any text part of your page\r\nVia config.yml, you can configure a list of jquery selectors meant to let appear tag context search by selecting text. \r\nOnce some text selected, a little div appears and displays several wikipedia entries with the entry title and a snippet. The results are the same than in an opensearch page \r\n(example with [découvrir](http://fr.wikipedia.org/w/index.php?search=d%C3%A9couvrir)). If you want this functionality, config.yml will look like this : \r\n\r\n        wiki_tag:\r\n            ...\r\n            reactive_selectors:\r\n                some_divs:  [ '.left_sheet', '#p_title .sheet_title', '#p_description' ]\r\n                only_p:     [ '#p_title .sheet_title', '#p_description' ]\r\n                whole_page: [ 'document' ]\r\n\r\nIf you want every text on your page to be reactive, the list has to be [ 'document' ].\r\nIn the templates, you have to call a specific javascript with the wanted parameter. Your javascript calls may look like this :\r\n\r\n        {% block js_declaration %}\r\n        {{ parent() }}\r\n        {% render \"WikiTagBundle:WikiTag:addJavascript\" with {'profile_name': 'editor'} %}\r\n        {% render \"WikiTagBundle:WikiTag:addJavascriptForContextSearch\" with {'context_name': 'some_divs'} %}\r\n        {% endblock %}\r\n\r\n## More configuration 3 : ignore wikipedia errors\r\nThis option allows to ignore wikipedia errors instead of raising an exception. The error is logged with an ERROR level and the tag is added/updated but not semantized.\r\n\r\n        wiki_tag:\r\n            ...    \r\n            ignore_wikipedia_error: true\r\n\r\n## More configuration 4 : curl parameters\r\nThis option enables to add any parameter to the curl requests, since the wikipedia request are made from the server. For example, it is useful when the server is behind a firewall.\r\n\r\n        wiki_tag:\r\n            ...    \r\n            curl_options:\r\n            \tCURLOPT_HTTPPROXYTUNNEL:  'TRUE'\r\n            \tCURLOPT_PROXYAUTH: 'CURLAUTH_NTLM'\r\n            \tCURLOPT_USERAGENT: 'Mozilla/5.0 Gecko/20100101 Firefox/10.0.1'\r\n            \tCURLOPT_PROXY: 'my.proxy.url:1234'\r\n            \tCURLOPT_PROXYUSERPWD: 'MY-DOMAIN\\user:password'\r\n            \tCURLOPT_PROXYTYPE: 'CURLPROXY_HTTP'\r\n\r\n## Services\r\n\r\n### Document Service : wiki_tag.document - IRI\\Bundle\\WikiTagBundle\\Services\\DocumentService \r\nThe document service gathers methods to manage tags on a given document. all these methods must be called after the host app's document(s) object has been created and flushed.\r\n\r\n* addTags : add a tag or a list pf tags to a document. For each new tag, wikipedia will be queried.\r\n\r\n* copyTags : copy the tags list from one document to the other.\r\n\r\n* reorderTags : reorder a document tags. \r\n\r\n* getTagsLabels : get the list of tag labels from one document.\r\n\r\n\r\n### Search service : wiki_tag.search - IRI\\Bundle\\WikiTagBundle\\Services\\SearchService\r\nThe search service allows searching documents\r\n\r\n* getTagCloud : returns a weighted list of tag labels. The weight of the label is the number of documents tagged with this label. The list is sorted by descending weights.  \r\n\r\n* search : search documents.\r\n\r\n## Commands\r\nThis bundle provides a number of commans that helps in the tags management.\r\n\r\n### wikitag:schema:create\r\nCommand to create the database schema. Equivalent to the doctrine:schema:create command.\r\nIt fully replaces the doctrine:schema:create and *must* be run instead of the doctrine:schema:create command. \r\n\r\n\r\n### wikitag:schema:update\r\nCommand to update the database schema. Equivalent to the doctrine:schema:update command.\r\nIt fully replaces the doctrine:schema:update and *must* be run instead of the doctrine:schema:update command.\r\n\r\n\r\n### wikitag:create-fulltext-indexes\r\nGenerate the sql to create the full text index on the database. This command is not destined to be directly called.\r\n\r\n### wikitag:generate-document-class\r\nGenerate the WikiTagBundle document class. This command should not be directly called.\r\n\r\n### wikitag:purge-tags\r\nRemoves tags associated to no documents.\r\n\r\n### wikitag:query-wikipedia\r\nQuery wikipedia for informations on tags.\r\n\r\n### wikitag:reorder-tags\r\nAutomatically reorder documents tags. For each documents treated, each tag of the document is scored according to the fields definition in the bundle configuration. The sorting of the tags is done document by document according to these scores. \r\n\r\n### wikitag:sync-doc\r\nSynchronize the wikiTag Bundle documents with the host bundle. This synchronization is made according to the fields defined in the bundle configuration.\r\n\r\n### wikitag:load-fixtures\r\nAllow loading of fixtures to populate the database.\r\n\r\nThe wikitag document table must exist and be synchronized. There fore the following commands must have been executed:\r\n  \r\n  +  php app/console wikitag:generate-document-class\r\n  +  php app/console wikitag:sync-doc\r\n\r\nThe wikitag\\_document.external\\_id field must match the datasheet field fo the taggedsheet table.\r\nThis command import in order categories, tags and documents\\_tags.\r\nyou may have memory problem. In this case you can import data by slices. Here is an example:\r\n\r\n  +  all categories : php app/console wikitag:load-fixtures -C /path/to/data.json\r\n  +  all tags : php app/console wikitag:load-fixtures -T /path/to/data.json\r\n  +  20000 first doctags: php app/console wikitag:load-fixtures -D -E 20000 /path/to/data.json\r\n  +  20000 other doctags: php app/console wikitag:load-fixtures -D -B 20001 -E 40000 /path/to/data.json\r\n  +  last doctags: php app/console wikitag:load-fixtures -B 40001 /path/to/data.json\r\n\r\nThe -B (index Begin) and -E (index End) works alson on the tags. Therefore you cans import tags also in slices.\r\n \r\n","tagline":"A bundle to tag object using wikipedia","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}